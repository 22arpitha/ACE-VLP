<div class="container-wrapper settings-main-content px-0">
  <section class="settings-table-bg px-3 leave-requests">
    <!-- Filters Row -->
    <div class="row mx-0 px-0">
      <div class="col-sm-12 col-md-6 col-lg-6">
        <div class="row mx-0 gx-0 align-content-center">
          <!-- period -->
          <div class="col-sm-12 col-md-6 col-lg-4 mb-1 pe-2">
            <mat-form-field appearance="outline" class="w-100 custom-mat-form-field">
              <mat-label>Period</mat-label>
              <mat-select autocomplete="off" placeholder="Select Period" panelClass="custom-select-panel"
                [(ngModel)]="selectedPeriod" (selectionChange)="selectedPeriodFunc($event)">
                <mat-option *ngFor="let item of periodValues; let i = index" [value]="item.key">{{
                  item.value }}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <!-- date range picker -->
          <div class="col-sm-12 col-md-6 col-lg-4" *ngIf="selectedPeriod==='custom'">
            <mat-form-field appearance="outline" class="w-100 custom-mat-form-field">
              <mat-date-range-input [rangePicker]="gobalPicker1">
                <input matStartDate id="leaveRequestStartDate" placeholder="Start date" [(ngModel)]="mainStartDate" (dateChange)="mainDateChange($event)">
                <input matEndDate id="leaveRequestEndDate" placeholder="End date" [(ngModel)]="mainEndDate" (dateChange)="mainEndDateChange($event)">
              </mat-date-range-input>
              <mat-datepicker-toggle matSuffix [for]="gobalPicker1"></mat-datepicker-toggle>
              <mat-date-range-picker #gobalPicker1 [dateClass]="dateClass"></mat-date-range-picker>
              <!-- <button matSuffix mat-icon-button *ngIf="mainStartDate || mainEndDate" >
                <mat-icon>close</mat-icon>
              </button> -->
            </mat-form-field>
          </div>
        </div>
      </div>

      <div class="col-sm-12 col-md-6 col-lg-6 text-end align-content-center">
        <button mat-raised-button class="cancel-button mat-btn-s" type="button" (click)="reset()">
          Reset
        </button>
        <button mat-raised-button class="proceedbtn mat-btn-s" (click)="openleaveForm()">
          Add Request
        </button>
      </div>
    </div>

    <!-- Table -->
    <div class="row mx-1 my-2 px-0 table-wrapper">
      <div class="col-12 px-0">
        <table class="table table table-hover table-list">
          <thead>
            <tr>
              <th scope="col">SL NO</th>
              <th scope="col">Employee Name
                <i *ngIf="!arrowState['employee_name']" class="bi bi-arrow-down"
                  (click)="sort('asc', 'employee_name')"></i>
                <i *ngIf="arrowState['employee_name']" class="bi bi-arrow-up"
                  (click)="sort('desc', 'employee_name')"></i>
                 <button mat-icon-button [matMenuTriggerFor]="employeesFilterMenu" (menuOpened)="openFilter(employeeFilter)"
                  [ngClass]="filters.employees.length>=1 ? 'filterdColumn':''">
                  <span *ngIf="filters.employees.length>=1">{{filters.employees.length.toString().padStart(2,
                    '0')}}</span>
                  <i class="bi-funnel" *ngIf="filters.employees.length===0"></i>
                </button>

                <mat-menu #employeesFilterMenu="matMenu">
                  <app-generic-table-filter #employeeFilter [fetchOptions]="fetchEmployees" [(selectedOptions)]="filters.employees"
                    (selectedOptionsChange)="getleaverequest()"></app-generic-table-filter>
                </mat-menu>


              </th>
              <th scope="col">LEAVE TYPE
                <button mat-icon-button [matMenuTriggerFor]="leaveTypeFilterMenu"
                    [ngClass]="filters.leave_type.length>=1 ? 'filterdColumn':''">
                    <span *ngIf="filters.leave_type.length>=1">{{filters.leave_type.length}}</span>
                    <i class="bi-funnel" *ngIf="filters.leave_type.length===0"></i>
                </button>

                <mat-menu #leaveTypeFilterMenu="matMenu">
                    <app-generic-table-filter [options]="leaveOptions"
                        [(selectedOptions)]="filters.leave_type"
                        (selectedOptionsChange)="onFilterChange($event, 'leave_type')">
                    </app-generic-table-filter>
                </mat-menu>
              </th>
              <th scope="col">LEAVE PERIOD
                <i *ngIf="!arrowState['leave_period']" class="bi bi-arrow-down"
                  (click)="sort('asc', 'leave_period')"></i>
                <i *ngIf="arrowState['leave_period']" class="bi bi-arrow-up" (click)="sort('desc', 'leave_period')"></i>
              </th>
              <th scope="col">DAYS
                <i *ngIf="!arrowState['number_of_leaves_applying_for']" class="bi bi-arrow-down"
                  (click)="sort('asc', 'number_of_leaves_applying_for')"></i>
                <i *ngIf="arrowState['number_of_leaves_applying_for']" class="bi bi-arrow-up"
                  (click)="sort('desc', 'number_of_leaves_applying_for')"></i>
              </th>
              <th scope="col">DATE OF REQUEST
                <i *ngIf="!arrowState['created_datetime']" class="bi bi-arrow-down"
                  (click)="sort('asc', 'created_datetime')"></i>
                <i *ngIf="arrowState['created_datetime']" class="bi bi-arrow-up"
                  (click)="sort('desc', 'created_datetime')"></i>
              </th>
              <th scope="col">STATUS
                <button mat-icon-button [matMenuTriggerFor]="statusFilterMenu"
                  [ngClass]="filters.status_name.length>=1 ? 'filterdColumn':''">
                  <span *ngIf="filters.status_name.length>=1">{{filters.status_name.length}}</span>
                  <i class="bi-funnel" *ngIf="filters.status_name.length===0"></i>
              </button>

              <mat-menu #statusFilterMenu="matMenu">
                  <app-generic-table-filter [options]="leaveStatus"
                      [(selectedOptions)]="filters.status_name"
                      (selectedOptionsChange)="onFilterChange($event, 'status_name')">
                  </app-generic-table-filter>
              </mat-menu>
              </th>
              <th scope="col">View</th>
            </tr>
          </thead>
          <tbody>
            <ng-container *ngIf="(leave_request) as result">
              <tr *ngFor='let item of result | customSort:directionValue:sortValue
                        |paginate : {
                                itemsPerPage: tableSize,
                                currentPage: page,
                                totalItems: count
                              }; let i=index'>
                <td>{{getContinuousIndex(i)}}</td>
                <td>{{ item.employee_name }}</td>
                <td>{{ item.leave_type_name }}</td>
                <td>{{ item.from_date | dateFormater }} - {{ item.to_date | dateFormater }}</td>
                <td>{{ item.number_of_leaves_applying_for }}</td>
                <td>{{ item.created_datetime | dateFormater }}</td>
                <td *ngIf="item.status === 'Pending'"><span style="background: #ffface; color: #978419;"
                    class="p-2 rounded">PENDING</span></td>
                <td *ngIf="item.status === 'approved'"><span style="background: #dcfce7; color: #15803d;"
                    class="p-2 rounded">APPROVED</span></td>
                <td *ngIf="item.status === 'rejected'"><span style="background:#fee2e2; color: #b91c1c;"
                    class="p-2 rounded">REJECTED</span></td>
                <td>
                  <!-- <i class="bi bi-eye fw-bold fs-4"></i> -->
                  <span>
                    <img src="../../../../assets/images/view.svg" class="icon-image" container="body" ngbTooltip="View"
                      (click)="viewDetails(item)" />
                  </span>
                </td>
              </tr>
            </ng-container>
          </tbody>
        </table>
      </div>
    </div>

    <!-- No Records -->
    <div class="row mx-1 my-2 px-0" *ngIf="leave_request?.length === 0">
      <app-generic-norecards></app-generic-norecards>
    </div>

    <!-- Pagination -->
    <div class="row mx-0 px-3" *ngIf="leave_request?.length > 0">
      <div class="col-12 px-0">
        <div class="pagination-container p-0">
          <pagination-controls previousLabel="Prev" nextLabel="Next" (pageChange)="onTableDataChange($event)">
          </pagination-controls>
          <div class="items-per-page-container">
            <div>Items per page</div>
            <mat-select [(ngModel)]="tableSize" (selectionChange)="onTableSizeChange($event)"
              panelClass="paginationPanelClass" class="page-size">
              <mat-option *ngFor="let size of tableSizes" [value]="size">{{
                size
                }}</mat-option>
            </mat-select>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>